<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="title" content="Command Prompt">
  <meta name="description" content="A custom browser-based command prompt terminal.">
  <meta name="author" content="SlimeTube">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Command Prompt</title>
  <style>
    html, body { margin:0; padding:0; height:100%; background:#000; color:#fff; overflow:hidden;
      background-size:100% 100%; background-repeat:no-repeat; background-position:center center;
      background-attachment:fixed; font-family:'VGA',monospace; }
    #indicator { background:#222; color:#0f0; padding:5px 10px; font-size:12px; }
    #terminal { height:100vh; padding:10px 10px 60px; box-sizing:border-box; overflow-y:auto; white-space:pre-wrap; }
    #input-container { position:fixed; bottom:0; left:0; right:0; background:#111; padding:10px; display:flex; z-index:1000; }
    #input-prompt { margin-right:5px; }
    #input { flex:1; background:transparent; border:none; outline:none; color:white;
      font-family:'VGA',monospace; font-size:16px; }
    #username-viewer { position:fixed; bottom:10px; right:10px; color:#0f0; background:#222;
      padding:5px 10px; font-family:'VGA',monospace; font-size:14px; border-radius:4px; user-select:none; z-index:1100;}
    @font-face { font-family:'VGA'; src:url('https://slimetube.github.io/vga.ttf'); }
    noscript { color:red; background:black; display:block; padding:20px; font-family:sans-serif; }
    img.avatar-inline { width:32px; height:32px; vertical-align:middle; border-radius:50%; margin-right:5px; }
  </style>
</head>
<body>
<noscript>âš  JavaScript is required. This terminal will not work without it.</noscript>
<div id="indicator"></div>
<div id="terminal"></div>
<div id="input-container">
  <span id="input-prompt">&gt;</span>
  <input id="input" autofocus spellcheck="false" />
</div>
<div id="username-viewer"></div>
<script type="module">
const terminal = document.getElementById('terminal');
const input = document.getElementById('input');
const indicator = document.getElementById('indicator');
const usernameViewer = document.getElementById('username-viewer');

const defaultPfps = [
  'https://i.imgur.com/D299rno.gif',
  'https://slimetube.github.io/src/carly.webp',
  'https://slimetube.github.io/src/sam.webp',
  'https://slimetube.github.io/src/fred.webp',
  'https://slimetube.github.io/src/spen.webp'
];
const defaultUsernames = ['bubble app','Hold Up','SillyBilly1234','iCarlyFan5465'];
const DEFAULT_WEBHOOK = "https://discord.com/api/webhooks/1393396765012660224/weXmVY6hr6lu25FmDQnmmLSvjEcqnWH6LKGzku-aBI32C3uflaH7eu4sbICNv78HCVN-";

let username = localStorage.getItem('cmd_username') || defaultUsernames[Math.floor(Math.random()*defaultUsernames.length)];
let pfp = localStorage.getItem('cmd_pfp') || defaultPfps[Math.floor(Math.random()*defaultPfps.length)];
let webhookUrl = localStorage.getItem('cmd_webhook') || DEFAULT_WEBHOOK;
const history = JSON.parse(localStorage.getItem('cmd_history')||'[]');
let historyIndex = history.length;

indicator.textContent = `Platform: ${navigator.platform} | UA: ${navigator.userAgent}`;

function escapeHtml(text){ return String(text).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }
function write(text,color){ const div=document.createElement('div'); div.innerHTML=text; if(color) div.style.color=color;
  terminal.appendChild(div); terminal.scrollTop=terminal.scrollHeight; }
function updateUsernameViewer(){ usernameViewer.textContent=`User: ${username}`; }

async function runCommand(cmd, piped=""){
  const parts = cmd.trim().split(' ');
  const base = parts[0].toLowerCase();
  let output = piped;

  if(base==='clear'){ terminal.innerHTML=''; output=""; }
  else if(base==='help'){ 
    const msg="Commands: clear, help, echo, setuser, setpfp, webhook, resethook, guild, bans";
    write(msg); output=msg;
  }
  else if(base==='echo'){
    output = parts.slice(1).join(' ') || piped;
    write(escapeHtml(output));
  }
  else if(base==='setuser'){
    if(parts[1]){ username = parts.slice(1).join(' '); localStorage.setItem('cmd_username',username); updateUsernameViewer(); write('Username set.'); output=username; }
  }
  else if(base==='setpfp'){
    if(parts[1]){ pfp = parts[1]; localStorage.setItem('cmd_pfp',pfp); write('PFP set.'); output=pfp; }
  }
  else if(base==='webhook'){
    if(parts[1]){ webhookUrl = parts[1]; localStorage.setItem('cmd_webhook',webhookUrl); write('Webhook set.'); output=webhookUrl; }
  }
  else if(base==='resethook'){
    webhookUrl = DEFAULT_WEBHOOK; localStorage.setItem('cmd_webhook', webhookUrl); write('Webhook reset to default.'); output=webhookUrl;
  }
  else if(base==='guild'){
    try {
      const res = await fetch(webhookUrl);
      const data = await res.json();
      if(data.guild_id){
        const info = `Guild ID: ${data.guild_id}\nChannel ID: ${data.channel_id}\nName: ${data.name}`;
        write(info);
        output = info;
      } else { write("Not a guild webhook"); output=""; }
    } catch(e){ write("Error fetching webhook info: "+e,'red'); output=""; }
  }
  else if(base==='bans'){
    try {
      const res = await fetch("https://giggityfiles.github.io/terminalbans.json");
      const bans = await res.json();
      const msg = "Banlist loaded ("+bans.length+" entries).";
      write(msg);
      output = JSON.stringify(bans);
    } catch(e){ write("Error loading bans: "+e,'red'); output=""; }
  }
  else { write(`Unknown command: ${cmd}`,'red'); }

  return output;
}

async function handlePipeline(commandLine){
  const commands = commandLine.split('|').map(c=>c.trim()).filter(Boolean);
  let piped = "";
  for(const cmd of commands){
    piped = await runCommand(cmd, piped);
  }
}

input.addEventListener('keydown', async (e)=>{
  if(e.key==='Enter'){
    const cmd=input.value.trim();
    if(!cmd) return;
    write('> '+cmd);
    history.push(cmd);
    localStorage.setItem('cmd_history',JSON.stringify(history));
    historyIndex=history.length;
    await handlePipeline(cmd);
    input.value='';
    input.focus();
  } else if(e.key==='ArrowUp'){
    if(historyIndex>0){ historyIndex--; input.value=history[historyIndex]; }
  } else if(e.key==='ArrowDown'){
    if(historyIndex<history.length-1){ historyIndex++; input.value=history[historyIndex]; }
    else { historyIndex=history.length; input.value=''; }
  }
});

updateUsernameViewer();

// Always show welcome
write(`Welcome ${username}! Type "help" to see commands.`);

// Run commands from URL if provided
const params = new URLSearchParams(window.location.search);
if (params.has('cmd')) {
  const cmdsFromUrl = decodeURIComponent(params.get('cmd'));
  if (cmdsFromUrl) {
    const cmdList = cmdsFromUrl.split(';').map(c => c.trim()).filter(Boolean);
    (async () => {
      for (const c of cmdList) {
        write('> ' + c);
        history.push(c);
        localStorage.setItem('cmd_history', JSON.stringify(history));
        historyIndex = history.length;
        await handlePipeline(c);
      }
    })();
  }
}
</script>
</body>
</html>
